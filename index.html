<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>杠铃配重计算器（专业版）</title>
<style>
  :root {
    --primary: #1890ff;
    --primary-hover: #40a9ff;
    --success: #52c41a;
    --warning: #faad14;
    --error: #f5222d;
    --text: rgba(0, 0, 0, 0.85);
    --text-secondary: rgba(0, 0, 0, 0.45);
    --border: #d9d9d9;
    --background: #f0f2f5;
    --card-bg: #ffffff;
    --plate-bg: #e6f7ff;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.5;
    color: var(--text);
    background-color: var(--background);
    padding: 20px;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
  }

  header {
    text-align: center;
    margin-bottom: 30px;
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 8px;
    color: var(--text);
  }

  .subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
  }

  .calculator-card {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding: 24px;
    margin-bottom: 24px;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 16px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text);
  }

  select, input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 1rem;
    transition: all 0.3s;
  }

  select:focus, input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
  }

  button {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    margin-top: 8px;
  }

  button:hover {
    background-color: var(--primary-hover);
  }

  .result-card {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    padding: 24px;
    display: none;
  }

  .result-title {
    font-size: 1.5rem;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .deload-badge {
    background: #e6f7ff;
    color: var(--primary);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
  }

  th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  th {
    font-weight: 500;
    background: rgba(0, 0, 0, 0.02);
  }

  .plates-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
  }

  .plate {
    background: var(--plate-bg);
    color: var(--primary);
    padding: 6px 12px;
    border-radius: 4px;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
  }

  .plate:before {
    content: "•";
    margin-right: 4px;
    font-weight: bold;
  }

  .weight-summary {
    background: rgba(0, 0, 0, 0.02);
    padding: 16px;
    border-radius: 8px;
    margin-top: 16px;
  }

  .weight-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .total-weight {
    font-weight: 600;
    font-size: 1.1rem;
    color: var(--primary);
    border-top: 1px solid var(--border);
    padding-top: 8px;
    margin-top: 8px;
  }

  .alert {
    padding: 12px;
    border-radius: 6px;
    margin: 12px 0;
  }

  .alert-warning {
    background: #fffbe6;
    border: 1px solid #ffe58f;
    color: var(--warning);
  }

  .alert-error {
    background: #fff1f0;
    border: 1px solid #ffa39e;
    color: var(--error);
  }

  @media (max-width: 600px) {
    body {
      padding: 12px;
    }
    
    .calculator-card, .result-card {
      padding: 16px;
    }
    
    h1 {
      font-size: 1.5rem;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
    }
    
    th, td {
      padding: 8px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>杠铃配重计算器</h1>
    <p class="subtitle">基于背包算法的智能配重方案</p>
  </header>

  <div class="calculator-card">
    <div class="form-grid">
      <div class="form-group">
        <label for="barWeight">杠铃杆重量 (kg)</label>
        <select id="barWeight">
          <option value="0">0 kg（无杠铃杆）</option>
          <option value="15">15 kg</option>
          <option value="20" selected>20 kg</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="rm">目标1RM (kg)</label>
        <input type="number" id="rm" min="1" step="0.25" value="120" required />
      </div>
      
      <div class="form-group">
        <label for="intensity">训练强度 (%1RM)</label>
        <select id="intensity" required>
          <option value="">请选择强度</option>
        </select>
      </div>
    </div>
    
    <button onclick="calculate()">计算配重方案</button>
  </div>

  <div id="result" class="result-card"></div>
</div>

<script>
  // 训练计划配置
  const intensityPlan = [
    { percent: 0.70, sets: 5, reps: 10, week: 1, name: "容量积累期" },
    { percent: 0.725, sets: 4, reps: 10, week: 2, name: "容量积累期" },
    { percent: 0.75, sets: 4, reps: 8, week: 3, name: "强度过渡期" },
    { percent: 0.775, sets: 3, reps: 8, week: 4, name: "强度过渡期" },
    { percent: 0.60, sets: 5, reps: 5, week: 5, name: "减载周", deload: true },
    { percent: 0.80, sets: 5, reps: 5, week: 6, name: "力量提升期" },
    { percent: 0.825, sets: 5, reps: 5, week: 7, name: "力量提升期" },
    { percent: 0.875, sets: 3, reps: 5, week: 8, name: "峰值准备期" },
    { percent: 0.925, sets: 3, reps: 3, week: 9, name: "峰值准备期" },
    { percent: 0.95, sets: 2, reps: 2, week: 10, name: "比赛/测试周" }
  ];

  // 配重片配置
  const standardPlates = [25, 20, 15, 10, 5, 2.5]; // 标准片无限供应
  const microPlates = [1, 0.5, 0.35]; // 微调片
  const microInventory = { 1: 2, 0.5: 2, 0.35: 2 }; // 微调片库存

  // 初始化强度选择器
  const intensitySelect = document.getElementById('intensity');
  intensityPlan.forEach(p => {
    const option = document.createElement('option');
    option.value = p.percent;
    option.textContent = `${(p.percent * 100).toFixed(1)}% - ${p.name}`;
    if (p.percent === 0.775) option.selected = true;
    intensitySelect.appendChild(option);
  });

  // 背包算法实现
  function knapsack(target, plates, inventory) {
    plates.sort((a, b) => b - a); // 从大到小排序
    
    let bestCombination = [];
    let bestDiff = target;
    let bestSum = 0;

    function backtrack(start, remaining, path, used) {
      const currentDiff = Math.abs(remaining);
      if (currentDiff < bestDiff || 
          (currentDiff === bestDiff && path.length < bestCombination.length)) {
        bestDiff = currentDiff;
        bestCombination = [...path];
        bestSum = target - remaining;
      }

      for (let i = start; i < plates.length; i++) {
        const plate = plates[i];
        const maxUse = inventory[plate] || Infinity;
        const usedCount = used[plate] || 0;

        if (usedCount < maxUse && remaining >= plate - 0.001) {
          used[plate] = (used[plate] || 0) + 1;
          path.push(plate);
          backtrack(i, remaining - plate, path, used);
          path.pop();
          used[plate]--;
        }
      }
    }

    backtrack(0, target, [], {});
    return { combination: bestCombination, sum: bestSum, diff: bestDiff };
  }

  // 计算配重
  function calculateWeight(target) {
    // 先用标准片计算基础重量
    let remaining = target;
    const standardCombo = [];
    for (const plate of standardPlates) {
      while (remaining >= plate - 0.001) {
        standardCombo.push(plate);
        remaining -= plate;
      }
    }

    // 剩余重量用微调片精确匹配
    const microResult = knapsack(remaining, microPlates, microInventory);
    
    return {
      combination: [...standardCombo, ...microResult.combination],
      sum: (target - remaining) + microResult.sum,
      diff: microResult.diff
    };
  }

  // 主计算函数
  function calculate() {
    const rm = parseFloat(document.getElementById('rm').value);
    const barWeight = parseFloat(document.getElementById('barWeight').value) || 0;
    const percent = parseFloat(intensitySelect.value);
    const resultDiv = document.getElementById('result');

    // 验证输入
    if (!rm || !percent) {
      resultDiv.innerHTML = `
        <div class="alert alert-error">
          请填写所有必填字段
        </div>
      `;
      resultDiv.style.display = 'block';
      return;
    }

    const targetWeight = rm * percent;
    if (targetWeight < barWeight) {
      resultDiv.innerHTML = `
        <div class="alert alert-error">
          错误：目标重量 ${targetWeight.toFixed(2)}kg 不能小于杆重 ${barWeight}kg
        </div>
      `;
      resultDiv.style.display = 'block';
      return;
    }

    const singleSideTarget = (targetWeight - barWeight) / 2;
    const result = calculateWeight(singleSideTarget);
    const plan = intensityPlan.find(p => p.percent === percent);

    // 准备结果输出
    let warning = '';
    if (result.diff > 0.001) {
      warning = `
        <div class="alert alert-warning">
          注意：比理论值轻 ${result.diff.toFixed(2)}kg (理论单边: ${singleSideTarget.toFixed(2)}kg)
        </div>
      `;
    }

    // 按重量分组统计配重片
    const plateCounts = {};
    result.combination.forEach(plate => {
      plateCounts[plate] = (plateCounts[plate] || 0) + 1;
    });
    const plateGroups = Object.entries(plateCounts)
      .sort((a, b) => b[0] - a[0])
      .map(([weight, count]) => `${count}×${weight}kg`);

    const actualTotal = barWeight + result.sum * 2;

    resultDiv.innerHTML = `
      <div class="result-title">
        <span>${plan.name} - 第${plan.week}周</span>
        ${plan.deload ? '<span class="deload-badge">减载周</span>' : ''}
      </div>
      
      <table>
        <tr>
          <th>训练强度</th>
          <th>组数</th>
          <th>次数</th>
          <th>理论重量</th>
        </tr>
        <tr>
          <td>${(percent*100).toFixed(1)}% 1RM</td>
          <td>${plan.sets}组</td>
          <td>${plan.reps}次</td>
          <td>${targetWeight.toFixed(2)}kg</td>
        </tr>
      </table>
      
      ${warning}
      
      <h3>配重方案</h3>
      <div class="plates-container">
        ${result.combination.sort((a,b) => b-a).map(w => `
          <span class="plate">${w}kg</span>
        `).join('')}
      </div>
      <div style="color: var(--text-secondary); margin-top: 8px;">
        配重片组合: ${plateGroups.join(' + ')}
      </div>
      
      <div class="weight-summary">
        <div class="weight-row">
          <span>杆重:</span>
          <span>${barWeight}kg</span>
        </div>
        <div class="weight-row">
          <span>单边配重:</span>
          <span>${result.sum.toFixed(2)}kg</span>
        </div>
        <div class="weight-row">
          <span>单边配重 × 2:</span>
          <span>${(result.sum * 2).toFixed(2)}kg</span>
        </div>
        <div class="weight-row total-weight">
          <span>实际总重量:</span>
          <span>${actualTotal.toFixed(2)}kg</span>
        </div>
      </div>
    `;
    resultDiv.style.display = 'block';
  }
</script>
</body>
</html>
